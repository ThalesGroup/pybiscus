<h1>Pybiscus session</h1>
<p>Waiting that server sets global configuration parameters</p>

<script>
    async function check() {
        const res = await fetch('{{server_url}}/session/server/parameters/check');
        const data = await res.json();
        if (data.ready) {
            
            console.log( "Session parameters are available !" );

            fetch('/session/client/parameters', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data.params)
            })
            .then(response => response.json()) // could be .text() according to bakend return
            .then(data => {
                console.log("Server response :", data);
                window.location.href = "/client/config";
            })
            .catch(error => {
                console.error("POST error: ", error);
            });
        } else {
            setTimeout(check, 1000);
        }
    }
    check();
</script>
